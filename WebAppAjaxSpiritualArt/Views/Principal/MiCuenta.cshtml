@model List<WebAppAjaxSpiritualArt.Models.REGISTRO_ARTISTA>
@{
    ViewBag.Title = "MiCuenta";
}

<h2>Mi Cuenta</h2>


@foreach (var item in Model)
{
    <input type="hidden" value="@item.PK_ID_ARTISTA" id="fk_artista" />
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Nombre</th>
                <th scope="col">Primer apellido</th>
                <th scope="col">Segundo apellido</th>
                <th scope="col">Correo y usuario</th>
                <th scope="col">Teléfono</th>
                <th scope="col">País</th>
                <th scope="col">Localidad</th>
                <th scope="col">Ciudad</th>
                <th scope="col">Dirección</th>
                <th scope="col">Mi clave</th>

            </tr>
        </thead>
        <tbody>
            <tr>

                <td>@item.NOMBRE_ARTISTA</td>
                <td>@item.PRIMER_APELLIDO_ARTISTA</td>
                <td>@item.SEGUNDO_APELLIDO_ARTISTA</td>
                <td>@item.CORREO</td>
                <td>@item.TELEFONO</td>
                <td>@item.PAIS</td>
                <td>@item.LOCALIDAD</td>
                <td>@item.CIUDAD</td>
                <td>@item.DIRECCION</td>
                <td>@item.CLAVE</td>
            </tr>

        </tbody>
    </table>
    <div class="col text-center">
        <button class="btn-success regular-button" onclick="ConsultarArtistaEditar(@Html.DisplayFor(datos => item.PK_ID_ARTISTA))">Modificar mis datos</button>
    </div>
}



<hr />

<div class="text-bg-dark mb-3" style="max-width: 25rem;">

    <div class="card-body">
        <h5 class="card-title">Mi Biografía</h5>
        <div id="parrafo">

        </div>
    </div>
</div>

<!-- Modal editar artista-->
<div class="modal fade" id="EditarArtista" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Mi Biografía</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>

                    <input type="hidden" id="pk-artista" />
                    <input type="hidden" id="plan" />
                    <input type="hidden" id="rutaImagen" />
                    
                    <div class="col-md-4">
                        <label for="validationCustom01" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="Nombre" required>

                    </div>
                    <div class="col">
                        <label for="validationCustom02" class="form-label">Primer Apellido</label>
                        <input type="text" class="form-control" id="PrimerApellido" required>

                    </div>
                    <div class="col-md-4">
                        <label for="validationCustomUsername" class="form-label">Segundo Apellido</label>
                        <div class="input-group has-validation">

                            <input type="text" class="form-control" id="SegundoApellido" aria-describedby="inputGroupPrepend" required>

                        </div>
                    </div>

                    <div class="col-md-4">
                        <label for="validationCustomUsername" class="form-label">Usuario</label>
                        <div class="input-group has-validation">

                            <input type="email" class="form-control" id="Usuario" aria-describedby="inputGroupPrepend" required>

                        </div>
                    </div>

                    <div class="col-md-4">
                        <label for="validationCustomUsername" class="form-label">Teléfono</label>
                        <div class="input-group has-validation">

                            <input type="tel" class="form-control" id="Telefono" aria-describedby="inputGroupPrepend" required>

                        </div>
                    </div>

                    <div class="col-md-4">
                        <label for="validationCustomUsername" class="form-label">País</label>
                        <div class="input-group has-validation">

                            <input type="text" class="form-control" id="Pais" aria-describedby="inputGroupPrepend" required>

                        </div>
                    </div>

                    <div class="col-md-4">
                        <label for="validationCustomUsername" class="form-label">Localidad</label>
                        <div class="input-group has-validation">

                            <input type="text" class="form-control" id="Localidad" aria-describedby="inputGroupPrepend" required>

                        </div>
                    </div>

                    <div class="col-md-4">
                        <label for="validationCustomUsername" class="form-label">Ciudad</label>
                        <div class="input-group has-validation">

                            <input type="text" class="form-control" id="Ciudad" aria-describedby="inputGroupPrepend" required>

                        </div>
                    </div>

                    <div class="col-md-4">
                        <label for="validationCustomUsername" class="form-label">Dirección</label>
                        <div class="input-group has-validation">

                            <input type="text" class="form-control" id="Direccion" aria-describedby="inputGroupPrepend" required>

                        </div>
                    </div>

                    <div class="col-md-4">
                        <label for="validationCustomUsername" class="form-label">Clave</label>
                        <div class="input-group has-validation">

                            <input type="number" class="form-control" id="Clave" aria-describedby="inputGroupPrepend" required>

                        </div>
                    </div>


                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-success" id="btn-cambios">Aplicar Cambios</button>
                
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script>
        function ConsultarBiografia() {
            let fk_artista = document.getElementById("fk_artista").value;
            fetch("@Url.Content("~/JsonProductos/enviarBiografia/")" + fk_artista)
               .then(function (res) {

                  return res.json();
               })

               .then(function (miJson) {

                   document.getElementById("parrafo").innerHTML = "";
                      if (miJson[0] != null) {
                          for (let i = 0; i < miJson.length; i++) {

                                  document.getElementById("parrafo").innerHTML = document.getElementById("parrafo").innerHTML +
                                      '<p class="card-text">' + miJson[i].BIOGRAFIATEXTO + '</p>'

                         }
                      } else {
                          document.getElementById("parrafo").innerHTML = document.getElementById("parrafo").innerHTML +
                              '<p class="card-text">El artista no ha publicado una biografía</p>'
                      }


               })
        }

         //funtion que consulta un artista para editarlo
        function ConsultarArtistaEditar(id) {
            console.log(id);
             fetch("@Url.Content("~/JsonProductos/ConsultarArtistaEditar/")" + id)
                .then(function (res) {

                    return res.json();
                })

                .then(function (miJson) {
                    console.log(miJson);
                    for (let i = 0; i < miJson.length; i++) {

                        document.getElementById("rutaImagen").value = miJson[i].IMAGEN;
                        document.getElementById("plan").value = miJson[i].FK_TIPO_PLAN;
                        document.getElementById("pk-artista").value = miJson[i].PK_ID_ARTISTA;
                        document.getElementById("Nombre").value = miJson[i].NOMBRE_ARTISTA;
                        document.getElementById("PrimerApellido").value = miJson[i].PRIMER_APELLIDO_ARTISTA;
                        document.getElementById("SegundoApellido").value = miJson[i].SEGUNDO_APELLIDO_ARTISTA;
                        document.getElementById("Usuario").value = miJson[i].CORREO;
                        document.getElementById("Telefono").value = miJson[i].TELEFONO;
                        document.getElementById("Pais").value = miJson[i].PAIS;
                        document.getElementById("Localidad").value = miJson[i].LOCALIDAD;
                        document.getElementById("Ciudad").value = miJson[i].CIUDAD;
                        document.getElementById("Direccion").value = miJson[i].DIRECCION;
                        document.getElementById("Clave").value = miJson[i].CLAVE;



                    }

                    abrirModalEditarArtita();
                })
        }

        //abre el modal editar artista
        function abrirModalEditarArtita() {
            $('#EditarArtista').modal('toggle');
        }

        //editar artista
        $(function () {
            $("#btn-cambios").click(function () {
                var form_data = new FormData();


                form_data.append("PK_ID_ARTISTA", $("#pk-artista").val());
                form_data.append("NOMBRE_ARTISTA", $("#Nombre").val());
                form_data.append("PRIMER_APELLIDO_ARTISTA", $("#PrimerApellido").val());
                form_data.append("SEGUNDO_APELLIDO_ARTISTA", $("#SegundoApellido").val());
                form_data.append("CORREO", $("#Usuario").val());
                form_data.append("TELEFONO", $("#Telefono").val());
                form_data.append("PAIS", $("#Pais").val());
                form_data.append("LOCALIDAD", $("#Localidad").val());
                form_data.append("CIUDAD", $("#Ciudad").val());
                form_data.append("DIRECCION", $("#Direccion").val());
                form_data.append("CLAVE", $("#Clave").val());
                form_data.append("FK_TIPO_PLAN", $("#plan").val());
                form_data.append("IMAGEN", $("#rutaImagen").val());

                swal({
                    title: "Deseas actualizar tus datos?",

                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {
                            var url = "@Url.Content("~/JsonProductos/EditarArtista")";

                            $.ajax({

                                cache: false,
                                contentType: false,
                                data: form_data,
                                dataType: 'JSON',
                                //enctype: 'multipart/form-data',
                                processData: false,
                                method: "POST",
                                url: url,
                                success: function (data) {
                                    if (data == 1) {
                                        swal("Se ha modificado exitosamente!", "", "success");
                                        ConsultarBiografia();
                                    } else {
                                        swal("Hubo un error en el sistema!", "Vuelve a intentarlo!", "success");
                                    }

                                }

                            })
                        }
                    });


            })


        });




        (ConsultarBiografia)();
    </script>
}

